
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Chapter 5 - Ensemble machine learning, deep learning &#8212; Text Analysis and Machine Learning (TAML) Group</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 6 - Writing about numeric data" href="Chapter6.html" />
    <link rel="prev" title="Chapter 4 - The BERT algorithm" href="Chapter4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Text Analysis and Machine Learning (TAML) Group</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to TAML!
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Python Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="how_to.html">
   i. How to use this book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="start.html">
   ii. Start coding!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boiler.html">
   iii. Boilerplate code review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrangle.html">
   iv. Numeric data wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="viz.html">
   v. Visualization essentials
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Winter Quarter 2022
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter1.html">
   Chapter 1 - English text preprocessing basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter2.html">
   Chapter 2 - Core machine learning concepts; building text vocabularies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter3.html">
   Chapter 3 - Document encoding (TF-IDF), topic modeling, sentiment analysis, building text classifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter4.html">
   Chapter 4 - The BERT algorithm
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chapter 5 - Ensemble machine learning, deep learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter6.html">
   Chapter 6 - Writing about numeric data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Chapter7.html">
   Chapter 7 - Combine the basics in powerful ways!
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="resources.html">
   Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Launch JupyterLab in Binder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Guest_Speakers.html">
   Guest Speakers
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/winter2022/Chapter5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/EastBayEv/SSDS-TAML"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/EastBayEv/SSDS-TAML/issues/new?title=Issue%20on%20page%20%2Fwinter2022/Chapter5.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/EastBayEv/SSDS-TAML/master?urlpath=tree/winter2022/Chapter5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ensemble-machine-learning">
   Ensemble machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#h2o-superlearner-ensemble">
   H2O SuperLearner ensemble
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deep-learning-basics">
   Deep learning basics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-makes-a-network-deep">
   What makes a network “deep”?
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-5-ensemble-machine-learning-deep-learning">
<h1>Chapter 5 - Ensemble machine learning, deep learning<a class="headerlink" href="#chapter-5-ensemble-machine-learning-deep-learning" title="Permalink to this headline">¶</a></h1>
<p>2022 February 23</p>
<p><img alt="kandc" src="../_images/kandc.jpg" /></p>
<p><a class="reference external" href="https://www.texasmonthly.com/the-daily-post/music-monday-uncovering-the-mystery-of-the-king-carter-jazzing-orchestra/">Texas Monthly, Music Monday: Uncovering The Mystery Of The King &amp; Carter Jazzing Orchestra</a></p>
<section id="ensemble-machine-learning">
<h2>Ensemble machine learning<a class="headerlink" href="#ensemble-machine-learning" title="Permalink to this headline">¶</a></h2>
<p>“Ensemble machine learning methods use multiple learning algorithms to obtain better predictive performance than could be obtained from any of the constituent learning algorithms.” <a class="reference external" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/stacked-ensembles.html">H2O.ai ensemble example</a></p>
<p>In this manner, SuperLearner ensembles are powerful tools because they:</p>
<ul class="simple">
<li><p>elucidate issues of algorithmic bias and variance</p></li>
<li><p>circumvent bias introduced by selecting single models</p></li>
<li><p>offer a means to optimize prediction through the stacking/blending of weaker models</p></li>
<li><p>allow for comparison of multiple algorithms, and/or comparison of the same model but tuned in many different ways</p></li>
<li><p>utilize a second-level algorithm that produces an ideal weighted prediction that is suitable for data of virtually all distributions and uses cross-validation to prevent overfitting</p></li>
</ul>
<p>The below example utilizes the h2o package, and requires Java to be installed on your machine.</p>
<ul class="simple">
<li><p>install Java: <a class="reference external" href="https://www.java.com/en/download/help/mac_install.html">https://www.java.com/en/download/help/mac_install.html</a></p></li>
<li><p>h2o SuperLearner example: <a class="reference external" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/stacked-ensembles.html">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/stacked-ensembles.html</a></p></li>
</ul>
<p>Check out some other great tutorials:</p>
<ul class="simple">
<li><p>Python mlens library: <a class="reference external" href="https://mlens.readthedocs.io/en/0.1.x/install/">https://mlens.readthedocs.io/en/0.1.x/install/</a></p></li>
<li><p>Machine Learning Mastery: <a class="reference external" href="https://machinelearningmastery.com/super-learner-ensemble-in-python/">https://machinelearningmastery.com/super-learner-ensemble-in-python/</a></p></li>
<li><p>KDNuggets: <a class="reference external" href="https://www.kdnuggets.com/2018/02/introduction-python-ensembles.html/2#comments">https://www.kdnuggets.com/2018/02/introduction-python-ensembles.html/2#comments</a></p></li>
</ul>
<p>The quintessential R guide:</p>
<ul class="simple">
<li><p>Guide to SuperLearner: <a class="reference external" href="https://cran.r-project.org/web/packages/SuperLearner/vignettes/Guide-to-SuperLearner.html">https://cran.r-project.org/web/packages/SuperLearner/vignettes/Guide-to-SuperLearner.html</a></p></li>
</ul>
<p>Read the papers:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.degruyter.com/document/doi/10.2202/1544-6115.1309/html">Van der Laan, M.J.; Polley, E.C.; Hubbard, A.E. Super Learner. Stat. Appl. Genet. Mol. Biol. 2007, 6, 1–21.</a></p></li>
<li><p><a class="reference external" href="https://biostats.bepress.com/ucbbiostat/paper266">Polley, E.C.; van der Laan, M.J. Super Learner in Prediction, UC Berkeley Division of Biostatistics Working Paper Series Paper 266.</a></p></li>
</ul>
</section>
<section id="h2o-superlearner-ensemble">
<h2>H2O SuperLearner ensemble<a class="headerlink" href="#h2o-superlearner-ensemble" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install h2o</span>

<span class="c1"># Requires install of Java</span>
<span class="c1"># https://www.java.com/en/download/help/mac_install.html</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h2o</span>
<span class="kn">from</span> <span class="nn">h2o.estimators.random_forest</span> <span class="kn">import</span> <span class="n">H2ORandomForestEstimator</span>
<span class="kn">from</span> <span class="nn">h2o.estimators.gbm</span> <span class="kn">import</span> <span class="n">H2OGradientBoostingEstimator</span>
<span class="kn">from</span> <span class="nn">h2o.estimators.stackedensemble</span> <span class="kn">import</span> <span class="n">H2OStackedEnsembleEstimator</span>
<span class="kn">from</span> <span class="nn">h2o.grid.grid_search</span> <span class="kn">import</span> <span class="n">H2OGridSearch</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="n">h2o</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Checking whether there is an H2O instance running at http://localhost:54321 .
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> connected.
Warning: Your H2O cluster version is too old (5 months and 8 days)!Please download and install the latest version from http://h2o.ai/download/
</pre></div>
</div>
<div class="output text_html"><div style="overflow:auto"><table style="width:50%"><tr><td>H2O_cluster_uptime:</td>
<td>10 mins 42 secs</td></tr>
<tr><td>H2O_cluster_timezone:</td>
<td>America/Los_Angeles</td></tr>
<tr><td>H2O_data_parsing_timezone:</td>
<td>UTC</td></tr>
<tr><td>H2O_cluster_version:</td>
<td>3.34.0.1</td></tr>
<tr><td>H2O_cluster_version_age:</td>
<td>5 months and 8 days !!!</td></tr>
<tr><td>H2O_cluster_name:</td>
<td>H2O_from_python_evanmuzzall_3e9b6s</td></tr>
<tr><td>H2O_cluster_total_nodes:</td>
<td>1</td></tr>
<tr><td>H2O_cluster_free_memory:</td>
<td>2.887 Gb</td></tr>
<tr><td>H2O_cluster_total_cores:</td>
<td>16</td></tr>
<tr><td>H2O_cluster_allowed_cores:</td>
<td>16</td></tr>
<tr><td>H2O_cluster_status:</td>
<td>locked, healthy</td></tr>
<tr><td>H2O_connection_url:</td>
<td>http://localhost:54321</td></tr>
<tr><td>H2O_connection_proxy:</td>
<td>{"http": null, "https": null}</td></tr>
<tr><td>H2O_internal_security:</td>
<td>False</td></tr>
<tr><td>H2O_API_Extensions:</td>
<td>Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4</td></tr>
<tr><td>Python_version:</td>
<td>3.8.8 final</td></tr></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Import a sample binary outcome train/test set into H2O</span>
<span class="c1"># Learn about subset of Higgs Boson dataset: https://www.kaggle.com/c/higgs-boson</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="s2">&quot;https://s3.amazonaws.com/erin-data/higgs/higgs_train_10k.csv&quot;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="s2">&quot;https://s3.amazonaws.com/erin-data/higgs/higgs_test_5k.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr><th style="text-align: right;">  response</th><th style="text-align: right;">      x1</th><th style="text-align: right;">       x2</th><th style="text-align: right;">         x3</th><th style="text-align: right;">      x4</th><th style="text-align: right;">       x5</th><th style="text-align: right;">      x6</th><th style="text-align: right;">        x7</th><th style="text-align: right;">        x8</th><th style="text-align: right;">     x9</th><th style="text-align: right;">     x10</th><th style="text-align: right;">      x11</th><th style="text-align: right;">      x12</th><th style="text-align: right;">    x13</th><th style="text-align: right;">     x14</th><th style="text-align: right;">       x15</th><th style="text-align: right;">      x16</th><th style="text-align: right;">    x17</th><th style="text-align: right;">     x18</th><th style="text-align: right;">       x19</th><th style="text-align: right;">        x20</th><th style="text-align: right;">    x21</th><th style="text-align: right;">     x22</th><th style="text-align: right;">     x23</th><th style="text-align: right;">     x24</th><th style="text-align: right;">     x25</th><th style="text-align: right;">     x26</th><th style="text-align: right;">     x27</th><th style="text-align: right;">     x28</th></tr>
</thead>
<tbody>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">0.869293</td><td style="text-align: right;">-0.635082</td><td style="text-align: right;"> 0.22569   </td><td style="text-align: right;">0.32747 </td><td style="text-align: right;">-0.689993</td><td style="text-align: right;">0.754202</td><td style="text-align: right;">-0.248573 </td><td style="text-align: right;">-1.09206  </td><td style="text-align: right;">0      </td><td style="text-align: right;">1.37499 </td><td style="text-align: right;">-0.653674</td><td style="text-align: right;"> 0.930349</td><td style="text-align: right;">1.10744</td><td style="text-align: right;">1.1389  </td><td style="text-align: right;">-1.5782   </td><td style="text-align: right;">-1.04699 </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.65793 </td><td style="text-align: right;">-0.0104546</td><td style="text-align: right;">-0.0457672 </td><td style="text-align: right;">3.10196</td><td style="text-align: right;">1.35376 </td><td style="text-align: right;">0.979563</td><td style="text-align: right;">0.978076</td><td style="text-align: right;">0.920005</td><td style="text-align: right;">0.721657</td><td style="text-align: right;">0.988751</td><td style="text-align: right;">0.876678</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">0.907542</td><td style="text-align: right;"> 0.329147</td><td style="text-align: right;"> 0.359412  </td><td style="text-align: right;">1.49797 </td><td style="text-align: right;">-0.31301 </td><td style="text-align: right;">1.09553 </td><td style="text-align: right;">-0.557525 </td><td style="text-align: right;">-1.58823  </td><td style="text-align: right;">2.17308</td><td style="text-align: right;">0.812581</td><td style="text-align: right;">-0.213642</td><td style="text-align: right;"> 1.27101 </td><td style="text-align: right;">2.21487</td><td style="text-align: right;">0.499994</td><td style="text-align: right;">-1.26143  </td><td style="text-align: right;"> 0.732156</td><td style="text-align: right;">0      </td><td style="text-align: right;">0.398701</td><td style="text-align: right;">-1.13893  </td><td style="text-align: right;">-0.00081911</td><td style="text-align: right;">0      </td><td style="text-align: right;">0.30222 </td><td style="text-align: right;">0.833048</td><td style="text-align: right;">0.9857  </td><td style="text-align: right;">0.978098</td><td style="text-align: right;">0.779732</td><td style="text-align: right;">0.992356</td><td style="text-align: right;">0.798343</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">0.798835</td><td style="text-align: right;"> 1.47064 </td><td style="text-align: right;">-1.63597   </td><td style="text-align: right;">0.453773</td><td style="text-align: right;"> 0.425629</td><td style="text-align: right;">1.10487 </td><td style="text-align: right;"> 1.28232  </td><td style="text-align: right;"> 1.38166  </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.851737</td><td style="text-align: right;"> 1.54066 </td><td style="text-align: right;">-0.81969 </td><td style="text-align: right;">2.21487</td><td style="text-align: right;">0.99349 </td><td style="text-align: right;"> 0.35608  </td><td style="text-align: right;">-0.208778</td><td style="text-align: right;">2.54822</td><td style="text-align: right;">1.25695 </td><td style="text-align: right;"> 1.12885  </td><td style="text-align: right;"> 0.900461  </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.909753</td><td style="text-align: right;">1.10833 </td><td style="text-align: right;">0.985692</td><td style="text-align: right;">0.951331</td><td style="text-align: right;">0.803252</td><td style="text-align: right;">0.865924</td><td style="text-align: right;">0.780118</td></tr>
<tr><td style="text-align: right;">         0</td><td style="text-align: right;">1.34438 </td><td style="text-align: right;">-0.876626</td><td style="text-align: right;"> 0.935913  </td><td style="text-align: right;">1.99205 </td><td style="text-align: right;"> 0.882454</td><td style="text-align: right;">1.78607 </td><td style="text-align: right;">-1.64678  </td><td style="text-align: right;">-0.942383 </td><td style="text-align: right;">0      </td><td style="text-align: right;">2.42326 </td><td style="text-align: right;">-0.676016</td><td style="text-align: right;"> 0.736159</td><td style="text-align: right;">2.21487</td><td style="text-align: right;">1.29872 </td><td style="text-align: right;">-1.43074  </td><td style="text-align: right;">-0.364658</td><td style="text-align: right;">0      </td><td style="text-align: right;">0.745313</td><td style="text-align: right;">-0.678379 </td><td style="text-align: right;">-1.36036   </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.946652</td><td style="text-align: right;">1.0287  </td><td style="text-align: right;">0.998656</td><td style="text-align: right;">0.728281</td><td style="text-align: right;">0.8692  </td><td style="text-align: right;">1.02674 </td><td style="text-align: right;">0.957904</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">1.10501 </td><td style="text-align: right;"> 0.321356</td><td style="text-align: right;"> 1.5224    </td><td style="text-align: right;">0.882808</td><td style="text-align: right;">-1.20535 </td><td style="text-align: right;">0.681466</td><td style="text-align: right;">-1.07046  </td><td style="text-align: right;">-0.921871 </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.800872</td><td style="text-align: right;"> 1.02097 </td><td style="text-align: right;"> 0.971407</td><td style="text-align: right;">2.21487</td><td style="text-align: right;">0.596761</td><td style="text-align: right;">-0.350273 </td><td style="text-align: right;"> 0.631194</td><td style="text-align: right;">0      </td><td style="text-align: right;">0.479999</td><td style="text-align: right;">-0.373566 </td><td style="text-align: right;"> 0.113041  </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.755856</td><td style="text-align: right;">1.36106 </td><td style="text-align: right;">0.98661 </td><td style="text-align: right;">0.838085</td><td style="text-align: right;">1.1333  </td><td style="text-align: right;">0.872245</td><td style="text-align: right;">0.808487</td></tr>
<tr><td style="text-align: right;">         0</td><td style="text-align: right;">1.59584 </td><td style="text-align: right;">-0.607811</td><td style="text-align: right;"> 0.00707492</td><td style="text-align: right;">1.81845 </td><td style="text-align: right;">-0.111906</td><td style="text-align: right;">0.84755 </td><td style="text-align: right;">-0.566437 </td><td style="text-align: right;"> 1.58124  </td><td style="text-align: right;">2.17308</td><td style="text-align: right;">0.755421</td><td style="text-align: right;"> 0.64311 </td><td style="text-align: right;"> 1.42637 </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.921661</td><td style="text-align: right;">-1.19043  </td><td style="text-align: right;">-1.61559 </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.651114</td><td style="text-align: right;">-0.654227 </td><td style="text-align: right;">-1.27434   </td><td style="text-align: right;">3.10196</td><td style="text-align: right;">0.823761</td><td style="text-align: right;">0.938191</td><td style="text-align: right;">0.971758</td><td style="text-align: right;">0.789176</td><td style="text-align: right;">0.430553</td><td style="text-align: right;">0.961357</td><td style="text-align: right;">0.957818</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">0.409391</td><td style="text-align: right;">-1.88468 </td><td style="text-align: right;">-1.02729   </td><td style="text-align: right;">1.67245 </td><td style="text-align: right;">-1.6046  </td><td style="text-align: right;">1.33801 </td><td style="text-align: right;"> 0.0554274</td><td style="text-align: right;"> 0.0134659</td><td style="text-align: right;">2.17308</td><td style="text-align: right;">0.509783</td><td style="text-align: right;">-1.03834 </td><td style="text-align: right;"> 0.707862</td><td style="text-align: right;">0      </td><td style="text-align: right;">0.746918</td><td style="text-align: right;">-0.358465 </td><td style="text-align: right;">-1.64665 </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.367058</td><td style="text-align: right;"> 0.0694965</td><td style="text-align: right;"> 1.37713   </td><td style="text-align: right;">3.10196</td><td style="text-align: right;">0.869418</td><td style="text-align: right;">1.22208 </td><td style="text-align: right;">1.00063 </td><td style="text-align: right;">0.545045</td><td style="text-align: right;">0.698653</td><td style="text-align: right;">0.977314</td><td style="text-align: right;">0.828786</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">0.933895</td><td style="text-align: right;"> 0.62913 </td><td style="text-align: right;"> 0.527535  </td><td style="text-align: right;">0.238033</td><td style="text-align: right;">-0.966569</td><td style="text-align: right;">0.547811</td><td style="text-align: right;">-0.0594392</td><td style="text-align: right;">-1.70687  </td><td style="text-align: right;">2.17308</td><td style="text-align: right;">0.941003</td><td style="text-align: right;">-2.65373 </td><td style="text-align: right;">-0.15722 </td><td style="text-align: right;">0      </td><td style="text-align: right;">1.03037 </td><td style="text-align: right;">-0.175505 </td><td style="text-align: right;"> 0.523021</td><td style="text-align: right;">2.54822</td><td style="text-align: right;">1.37355 </td><td style="text-align: right;"> 1.29125  </td><td style="text-align: right;">-1.46745   </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.901837</td><td style="text-align: right;">1.08367 </td><td style="text-align: right;">0.979696</td><td style="text-align: right;">0.7833  </td><td style="text-align: right;">0.849195</td><td style="text-align: right;">0.894356</td><td style="text-align: right;">0.774879</td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">1.40514 </td><td style="text-align: right;"> 0.536603</td><td style="text-align: right;"> 0.689554  </td><td style="text-align: right;">1.17957 </td><td style="text-align: right;">-0.110061</td><td style="text-align: right;">3.2024  </td><td style="text-align: right;">-1.52696  </td><td style="text-align: right;">-1.57603  </td><td style="text-align: right;">0      </td><td style="text-align: right;">2.93154 </td><td style="text-align: right;"> 0.567342</td><td style="text-align: right;">-0.130033</td><td style="text-align: right;">2.21487</td><td style="text-align: right;">1.78712 </td><td style="text-align: right;"> 0.899499 </td><td style="text-align: right;"> 0.585151</td><td style="text-align: right;">2.54822</td><td style="text-align: right;">0.401865</td><td style="text-align: right;">-0.151202 </td><td style="text-align: right;"> 1.16349   </td><td style="text-align: right;">0      </td><td style="text-align: right;">1.66707 </td><td style="text-align: right;">4.03927 </td><td style="text-align: right;">1.17583 </td><td style="text-align: right;">1.04535 </td><td style="text-align: right;">1.54297 </td><td style="text-align: right;">3.53483 </td><td style="text-align: right;">2.74075 </td></tr>
<tr><td style="text-align: right;">         1</td><td style="text-align: right;">1.17657 </td><td style="text-align: right;"> 0.104161</td><td style="text-align: right;"> 1.397     </td><td style="text-align: right;">0.479721</td><td style="text-align: right;"> 0.265513</td><td style="text-align: right;">1.13556 </td><td style="text-align: right;"> 1.53483  </td><td style="text-align: right;">-0.253291 </td><td style="text-align: right;">0      </td><td style="text-align: right;">1.02725 </td><td style="text-align: right;"> 0.534316</td><td style="text-align: right;"> 1.18002 </td><td style="text-align: right;">0      </td><td style="text-align: right;">2.40566 </td><td style="text-align: right;"> 0.0875568</td><td style="text-align: right;">-0.976534</td><td style="text-align: right;">2.54822</td><td style="text-align: right;">1.25038 </td><td style="text-align: right;"> 0.268541 </td><td style="text-align: right;"> 0.530334  </td><td style="text-align: right;">0      </td><td style="text-align: right;">0.833175</td><td style="text-align: right;">0.773968</td><td style="text-align: right;">0.98575 </td><td style="text-align: right;">1.1037  </td><td style="text-align: right;">0.84914 </td><td style="text-align: right;">0.937104</td><td style="text-align: right;">0.812364</td></tr>
</tbody>
</table></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10000, 29)
(5000, 29)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify predictors and response</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span>
<span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;response&quot;</span>
<span class="n">x</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For binary classification, response should be a factor</span>
<span class="n">train</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">asfactor</span><span class="p">()</span>
<span class="n">test</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">asfactor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of CV folds (to generate level-one data for stacking)</span>
<span class="n">nfolds</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># There are a few ways to assemble a list of models to stack together:</span>
<span class="c1"># 1. Train individual models and put them in a list</span>
<span class="c1"># 2. Train a grid of models</span>
<span class="c1"># 3. Train several grids of models</span>
<span class="c1"># Note: All base models must have the same cross-validation folds and</span>
<span class="c1"># the cross-validated predicted values must be kept.</span>


<span class="c1"># 1. Generate a 2-model ensemble (GBM + RF)</span>

<span class="c1"># Train and cross-validate a GBM</span>
<span class="n">my_gbm</span> <span class="o">=</span> <span class="n">H2OGradientBoostingEstimator</span><span class="p">(</span><span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;bernoulli&quot;</span><span class="p">,</span>
                                      <span class="n">ntrees</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                      <span class="n">min_rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">learn_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                      <span class="n">nfolds</span><span class="o">=</span><span class="n">nfolds</span><span class="p">,</span>
                                      <span class="n">fold_assignment</span><span class="o">=</span><span class="s2">&quot;Modulo&quot;</span><span class="p">,</span>
                                      <span class="n">keep_cross_validation_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">my_gbm</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Train and cross-validate a RF</span>
<span class="n">my_rf</span> <span class="o">=</span> <span class="n">H2ORandomForestEstimator</span><span class="p">(</span><span class="n">ntrees</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                 <span class="n">nfolds</span><span class="o">=</span><span class="n">nfolds</span><span class="p">,</span>
                                 <span class="n">fold_assignment</span><span class="o">=</span><span class="s2">&quot;Modulo&quot;</span><span class="p">,</span>
                                 <span class="n">keep_cross_validation_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">my_rf</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Train a stacked ensemble using the GBM and GLM above</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">H2OStackedEnsembleEstimator</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;my_ensemble_binomial&quot;</span><span class="p">,</span>
                                       <span class="n">base_models</span><span class="o">=</span><span class="p">[</span><span class="n">my_gbm</span><span class="p">,</span> <span class="n">my_rf</span><span class="p">])</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># Eval ensemble performance on the test data</span>
<span class="n">perf_stack_test</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">model_performance</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Compare to base learner performance on the test set</span>
<span class="n">perf_gbm_test</span> <span class="o">=</span> <span class="n">my_gbm</span><span class="o">.</span><span class="n">model_performance</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">perf_rf_test</span> <span class="o">=</span> <span class="n">my_rf</span><span class="o">.</span><span class="n">model_performance</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">baselearner_best_auc_test</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">perf_gbm_test</span><span class="o">.</span><span class="n">auc</span><span class="p">(),</span> <span class="n">perf_rf_test</span><span class="o">.</span><span class="n">auc</span><span class="p">())</span>
<span class="n">stack_auc_test</span> <span class="o">=</span> <span class="n">perf_stack_test</span><span class="o">.</span><span class="n">auc</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Base-learner Test AUC:  </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baselearner_best_auc_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensemble Test AUC:  </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_auc_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Generate predictions on a test set (if neccessary)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>


<span class="c1"># 2. Generate a random grid of models and stack them together</span>

<span class="c1"># Specify GBM hyperparameters for the grid</span>
<span class="n">hyper_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;learn_rate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span>
                <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                <span class="s2">&quot;sample_rate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                <span class="s2">&quot;col_sample_rate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]}</span>
<span class="n">search_criteria</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;RandomDiscrete&quot;</span><span class="p">,</span> <span class="s2">&quot;max_models&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Train the grid</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">H2OGridSearch</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">H2OGradientBoostingEstimator</span><span class="p">(</span><span class="n">ntrees</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                                        <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">nfolds</span><span class="o">=</span><span class="n">nfolds</span><span class="p">,</span>
                                                        <span class="n">fold_assignment</span><span class="o">=</span><span class="s2">&quot;Modulo&quot;</span><span class="p">,</span>
                                                        <span class="n">keep_cross_validation_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">hyper_params</span><span class="o">=</span><span class="n">hyper_params</span><span class="p">,</span>
                     <span class="n">search_criteria</span><span class="o">=</span><span class="n">search_criteria</span><span class="p">,</span>
                     <span class="n">grid_id</span><span class="o">=</span><span class="s2">&quot;gbm_grid_binomial&quot;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Train a stacked ensemble using the GBM grid</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">H2OStackedEnsembleEstimator</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;my_ensemble_gbm_grid_binomial&quot;</span><span class="p">,</span>
                                       <span class="n">base_models</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">model_ids</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># Eval ensemble performance on the test data</span>
<span class="n">perf_stack_test</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">model_performance</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="c1"># Compare to base learner performance on the test set</span>
<span class="n">baselearner_best_auc_test</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">h2o</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">model_performance</span><span class="p">(</span><span class="n">test_data</span><span class="o">=</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">auc</span><span class="p">()</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">model_ids</span><span class="p">])</span>
<span class="n">stack_auc_test</span> <span class="o">=</span> <span class="n">perf_stack_test</span><span class="o">.</span><span class="n">auc</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Base-learner Test AUC:  </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baselearner_best_auc_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ensemble Test AUC:  </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_auc_test</span><span class="p">))</span>

<span class="c1"># Generate predictions on a test set (if neccessary)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="deep-learning-basics">
<h2>Deep learning basics<a class="headerlink" href="#deep-learning-basics" title="Permalink to this headline">¶</a></h2>
<p>Deep learning is a subfield of machine learning that uses a variety of multi-layered artificial neural networks to model datasets and predict outcomes. Deep learning is ideal for numeric, text, image, video, and sound data because deep representative networks store these data as large matrices and recycle error to make better predictions during the next epoch.</p>
<p>To understand deep networks, let’s start with a toy example of a single feed forward neural network - a perceptron.</p>
<p>Read Goodfellow et al’s Deep Learning Book to learn more: <a class="reference external" href="https://www.deeplearningbook.org/">https://www.deeplearningbook.org/</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># generate toy dataset</span>
<span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
           <span class="s1">&#39;x2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
           <span class="s1">&#39;xm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">]</span>
           <span class="p">}</span>
<span class="n">example_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">example</span><span class="p">)</span>
<span class="n">example_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x1</th>
      <th>x2</th>
      <th>xm</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>no</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>yes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><img alt="perceptron" src="../_images/perceptron.png" /></p>
<p>Perceptron figure modified from <a class="reference external" href="https://sebastianraschka.com/Articles/2015_singlelayer_neurons.html">Sebastian Raschka’s Single-Layer Neural Networks and Gradient Descent</a></p>
<p>Perceptron key terms:</p>
<ul class="simple">
<li><p><strong>Layer:</strong> the network typology of a deep learning model, usually divided into variations of input, hidden, preprocessing, encoder/decoder, and output.</p></li>
<li><p><strong>Inputs:</strong> the features/covariates for a single observation. These are just the individual cells in a dataframe (the 1’s and 0s from <code class="docutils literal notranslate"><span class="pre">example_df</span></code> above), but they could be words from a text or pixels from an image.</p></li>
<li><p><strong>Weights:</strong> the learnable parameters of a model that connect the input layer to the output via the net input (summation) and activation functions.</p></li>
<li><p><strong>Bias term:</strong> A placeholder “1” assures that we do not receive 0 outputs by default.</p></li>
<li><p><strong>Net input function:</strong> computes the weighted sum of the input layer.</p></li>
<li><p><strong>Activation function:</strong> determine if a neuron should be fired or not. In binary classification for example, this means should a 1 or 0 be output?</p></li>
<li><p>Output: one node that contains the y prediction</p></li>
<li><p><strong>Error:</strong> how far off an output prediction was. The weights can be updated by adjusting the learning rate based on the error to reduce it for the next epoch</p></li>
</ul>
</section>
<section id="what-makes-a-network-deep">
<h2>What makes a network “deep”?<a class="headerlink" href="#what-makes-a-network-deep" title="Permalink to this headline">¶</a></h2>
<p>A “deep” network is just network with multiple/many hidden layers for handling potential nonlinear transformations.</p>
<ul class="simple">
<li><p>Fully connected layer: a layer where all nodes are connected to every node in the next layer (as indicated by the purple arrows</p></li>
</ul>
<p><img alt="deep" src="../_images/deep.png" /></p>
<p>Example of “deep” network with two hidden layers modified from <a class="reference external" href="https://devskrol.com/2020/11/22/388/">DevSkrol’s Artificial Neural Network Explained with an Regression Example</a></p>
<blockquote>
<div><p>NOTE: Bias term not shown for some reason!</p>
</div></blockquote>
<p>Let’s go through François Chollet’s “Image classification from scratch” <a class="reference external" href="https://keras.io/examples/vision/image_classification_from_scratch/">tutorial</a> to examine this architecture to predict images of cats versus dogs.</p>
<p><a class="reference external" href="https://colab.research.google.com/github/keras-team/keras-io/blob/master/examples/vision/ipynb/image_classification_from_scratch.ipynb">Click here to open the Colab notebook</a></p>
<p>You should also check out his deep learning book! <a class="reference external" href="https://www.manning.com/books/deep-learning-with-python-second-edition">https://www.manning.com/books/deep-learning-with-python-second-edition</a></p>
<p><img alt="dogcat" src="../_images/dogcat.jpg" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "EastBayEv/SSDS-TAML",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./winter2022"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Chapter4.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Chapter 4 - The BERT algorithm</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Chapter6.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Chapter 6 - Writing about numeric data</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Software and Services for Data Science (SSDS) at Stanford Libraries<br/>
        
            &copy; Copyright 2021-2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>